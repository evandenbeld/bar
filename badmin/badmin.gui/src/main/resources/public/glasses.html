<link rel="import" href="glass.html">
<link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-toast/paper-toast.html">

<dom-module id="glass-list">
	<template>
		<style>
			
	      div.glasses img {     
	        border: 0px;
	        width: 100px;
	        height: 100px;
	    	padding: 2px;
	    	opacity: 0.7;
	      }    
	      div.glasses img:hover {
	      	opacity: 1.0;
		  } 
		  
		  div.glasses, h2 {
		  	width: 350px;
		  	margin-left: auto;
		  	margin-right: auto;
		  	text-align: center;
		  }
	    </style>
	    	         	
       	<h2>Glasses</h2>
       	<paper-toast id="toast" duration="3000"></paper-toast>
		<div class="horizontal layout wrap glasses">     
	        <template is="dom-repeat" items="{{glasses}}">
	       		<img src="{{service-url}}/{{item.id}}/icon" alt="{{item.name}}" title="{{item.name}}" on-tap="openDetail" >
		   	</template>
	  	</div>
	  	
	  	<iron-ajax id="retrieveGlasses" auto url="{{service-url}}" handle-as="json" 
			on-response="gotGlasses" on-error="gotError"></iron-ajax>
	  	
	  	<glass-detail id="glassDetail" service-url="{{service-url}}"></glass-detail>	  
	    
	</template>
	<script>
	    Polymer({
	      is: 'glass-list',
	      ready: function() {
	    	  	console.debug('Glass list started');
	    	  	this.$.glassDetail.addEventListener('glass-saved', function (e)
	    		{
	    			retrieveGlasses.generateRequest();
	    	    });
	      },	  
	      gotGlasses: function(event, ironRequest) {
	          this.glasses = ironRequest.response;
	      },
	      gotError: function(event, ironRequest){
	    	  console.debug(event.detail.error);
	    	  var toast=document.querySelector("#toast");
	          toast.text="Could not retrieve glasses: "+event.detail.error;
	          toast.show();
	      },
	      openDetail: function(event) {
		    console.debug(event.model.item);
			this.$.glassDetail.open(event.model.item);
		  },		  		  
	    }); 
	</script>

</dom-module>